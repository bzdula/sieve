require "vnd.stalwart.testsuite";
require "vnd.stalwart.environment";
require "variables";

test "default-mailbox" {
	if not environment :is "vnd.stalwart.default-mailbox" "INBOX" {
		if environment :matches "vnd.stalwart.default-mailbox" "*" { set "env" "${1}"; }

		test_fail "vnd.stalwart.default-mailbox environment returned invalid value(1): `${env}'";
	}
}

test "username" {
	if not environment :contains "vnd.stalwart.username" "" {
		test_fail "vnd.stalwart.username environment does not exist";
	}
}

test_config_set "sieve_env_display_name" "Jan Jansen";
test_config_reload :extension "vnd.stalwart.environment";

test "config" {
	if not environment :contains "vnd.stalwart.config.display_name" "" {
		test_fail "vnd.stalwart.config.display_name environment does not exist";
	}
	if not environment :is "vnd.stalwart.config.display_name" "Jan Jansen" {
		test_fail "vnd.stalwart.config.display_name environment has wrong value";
	}
}
